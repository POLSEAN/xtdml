rsmp_tune  = mlr3::rsmp("cv", folds = 3),
terminator = mlr3tuning::trm("evals", n_evals = 10),
tuner      = tnr("grid_search", resolution = 10))
xtdml_nnet$tune(param_set = param_grid, tune_settings = tune_settings)
xtdml_nnet$fit()
#xtdml_nnet$print()
xtdml_nnet$summary()
#____________________________________________________________________________#
# Display table that compares results
#____________________________________________________________________________#
table = matrix(0, 8, 3)
table[,1] = cbind(xtdml_boost$coef_theta,
xtdml_boost$se_theta,
xtdml_boost$pval_theta,
xtdml_boost$model_rmse,
as.numeric(xtdml_boost$rmses["ml_l"]),
as.numeric(xtdml_boost$rmses["ml_m"]),
xtdml_boost$data$n_obs,
length(unique(xtdml_boost$data$data_model[[xtdml_boost$data$cluster_cols]])))
table[,2] = cbind(xtdml_lasso$coef_theta,
xtdml_lasso$se_theta,
xtdml_lasso$pval_theta,
xtdml_lasso$model_rmse,
as.numeric(xtdml_lasso$rmses["ml_l"]),
as.numeric(xtdml_lasso$rmses["ml_m"]),
xtdml_lasso$data$n_obs,
length(unique(xtdml_lasso$data$data_model[[xtdml_lasso$data$cluster_cols]])))
table[,3] = cbind(xtdml_nnet$coef_theta,
xtdml_nnet$se_theta,
xtdml_nnet$pval_theta,
xtdml_nnet$model_rmse,
as.numeric(xtdml_nnet$rmses["ml_l"]),
as.numeric(xtdml_nnet$rmses["ml_m"]),
xtdml_nnet$data$n_obs,
length(unique(xtdml_nnet$data$data_model[[xtdml_nnet$data$cluster_cols]])))
rownames(table)= c("Estimate", "Std. Error", "P-value", "Model RMSE", "MSE of l", "MSE of m",
"No. observations","No. groups")
colnames(table)= c("xtdml-Boosting", "xtdml-Lasso", "xtdml-Nnet")
print(round(table, 3))
toc()
}
#______________________________________________________________________________#
# Title:  Implementation of `xtdml` with simulated data
# Date: 01 October 2025
#______________________________________________________________________________#
rm(list = ls())
wd = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS"
setwd(wd)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
setwd(wd.pack)
devtools::load_all()
# Installation from CRAN
#install.packages("xtdml")
#library(xtdml)
# # # Installation from GitHub
# library(devtools)
# install_github("POLSEAN/xtdml")
# library(xtdml)
# wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
# setwd(wd.pack)
# devtools::load_all()
#______________________________________________________________________________#
# Install packages
# list.of.packages <- c("mlr3","mlr3learners","mlr3tuning","paradox","mlr3misc",
#                       "glmnet","xgboost","tibble", "dplyr","datawizard","data.table",
#                       "glue","MLmetrics","devtools","tictoc","wooldridge")
# new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
# if(length(new.packages)) install.packages(new.packages, repos = "http://cran.us.r-project.org")
library(mlr3)
library(mlr3learners)
library(paradox)
library(mlr3tuning)
library(mlr3misc)
library(glmnet)
library(xgboost)
library(nnet)
library(tibble)
library(dplyr)
library(datawizard)
library(data.table)
library(wooldridge)
library(tictoc)
# Suppress warning messages
lgr::get_logger("mlr3")$set_threshold("warn")
lgr::get_logger("bbotk")$set_threshold("warn")
#______________________________________________________________________________#
data('crime4')
yvar  = "crmrte"
dvar  = "polpc"
pvars = c("prbarr","prbconv","prbpris","avgsen")
xvars = c("density", "taxpc","west","central","urban","pctmin80",
"wcon","wtuc","wtrd","wfir","wser","wmfg","wfed","wsta","wloc",
"mix", "pctymle","d82", "d83","d84", "d85", "d86", "d87")
ln_xvars = c("lcrmrte","lprbarr","lprbconv", "lprbpris", "lavgsen", "ldensity",
"ltaxpc", "lwcon","lwtuc","lwtrd","lwfir","lwser","lwmfg",
"lwfed","lwsta","lwloc","lmix", "lpctymle", "lpctmin")
#______________________________________________________________________________#
approaches = "wg-approx" #c("fd-exact","cre", "wg-approx")
for (approach in approaches){
print(paste0("approach:", approach))
tic(paste0(approach, "-run"))
set.seed(1234)
#______________________________________________________________________________#
# gradient boosting
#______________________________________________________________________________#
obj_xtdml_data_boost = xtdml_data_from_data_frame(crime4,
x_cols = c(xvars,pvars),  y_col = yvar, d_cols = dvar,
panel_id = "county", time_id = "year",
approach = approach, transformX = "no")
print(obj_xtdml_data_boost)
learner = lrn("regr.xgboost", nrounds = 100)
ml_m = learner$clone()
ml_l = learner$clone()
ml_g = learner$clone()
xtdml_boost = xtdml_plr$new(obj_xtdml_data_boost,
ml_l = ml_l, ml_m = ml_m, ml_g = ml_g,
n_folds = 3,
score = "orth-IV",
dml_procedure = "dml2",
draw_sample_splitting = TRUE,
apply_cross_fitting = TRUE)
param_grid = list("ml_l" = ps(max_depth = p_int(lower = 2, upper = 10),
lambda = p_dbl(lower = 0, upper = 5)),
"ml_m" = ps(max_depth = p_int(lower = 2, upper = 10),
lambda = p_dbl(lower = 0, upper = 2)),
"ml_g" = ps(max_depth = p_int(lower = 2, upper = 10),
lambda = p_dbl(lower = 0, upper = 2)))
tune_settings = list(n_folds_tune = 3,
rsmp_tune = mlr3::rsmp("cv", folds = 3),
terminator = mlr3tuning::trm("evals", n_evals = 10),
tuner = tnr("grid_search", resolution = 10))
xtdml_boost$tune(param_set = param_grid, tune_settings = tune_settings)
xtdml_boost$fit()
#xtdml_boost$print()
xtdml_boost$summary()
#______________________________________________________________________________#
# lasso
#______________________________________________________________________________#
obj_xtdml_data_lasso = xtdml_data_from_data_frame(crime4,
x_cols = c(xvars,ln_xvars,pvars),  y_col = yvar, d_cols = dvar,
panel_id = "county", time_id = "year",
approach = approach, transformX = "poly")
#print(obj_xtdml_data_lasso)
learner = lrn("regr.cv_glmnet", s="lambda.min")
ml_m = learner$clone()
ml_l = learner$clone()
ml_g = learner$clone()
xtdml_lasso = xtdml_plr$new(obj_xtdml_data_lasso,
ml_l = ml_l, ml_m = ml_m,ml_g = ml_g,
score = "orth-IV",
n_folds = 3)
xtdml_lasso$fit()
#xtdml_lasso$print()
xtdml_lasso$summary()
#______________________________________________________________________________#
# nnet
#______________________________________________________________________________#
obj_xtdml_data_nnet = xtdml_data_from_data_frame(crime4,
x_cols = c(xvars,pvars),  y_col = yvar, d_cols = dvar,
panel_id = "county", time_id = "year",
approach = approach, transformX = "minmax")
print(obj_xtdml_data_nnet)
ml_l = lrn("regr.nnet", maxit=100, MaxNWts=1000, trace=FALSE)
ml_m = lrn("regr.nnet", maxit=100, MaxNWts=1000, trace=FALSE)
ml_g = lrn("regr.nnet", maxit=100, MaxNWts=1000, trace=FALSE)
xtdml_nnet = xtdml_plr$new(obj_xtdml_data_nnet,
ml_l = ml_l, ml_m = ml_m,ml_g = ml_g,
score = "orth-IV",
n_folds = 3)
param_grid = list("ml_l" = ps(size = p_int(lower = 2, upper = 10),
decay = p_dbl(lower = 0, upper = 0.05)),
"ml_m" = ps(size = p_int(lower = 2, upper = 10),
decay = p_dbl(lower = 0, upper =  0.05)),
"ml_g" = ps(size = p_int(lower = 2, upper = 10),
decay = p_dbl(lower = 0, upper =  0.05)))
tune_settings = list(n_folds_tune = 3,
rsmp_tune  = mlr3::rsmp("cv", folds = 3),
terminator = mlr3tuning::trm("evals", n_evals = 10),
tuner      = tnr("grid_search", resolution = 10))
xtdml_nnet$tune(param_set = param_grid, tune_settings = tune_settings)
xtdml_nnet$fit()
#xtdml_nnet$print()
xtdml_nnet$summary()
#____________________________________________________________________________#
# Display table that compares results
#____________________________________________________________________________#
table = matrix(0, 8, 3)
table[,1] = cbind(xtdml_boost$coef_theta,
xtdml_boost$se_theta,
xtdml_boost$pval_theta,
xtdml_boost$model_rmse,
as.numeric(xtdml_boost$rmses["ml_l"]),
as.numeric(xtdml_boost$rmses["ml_m"]),
xtdml_boost$data$n_obs,
length(unique(xtdml_boost$data$data_model[[xtdml_boost$data$cluster_cols]])))
table[,2] = cbind(xtdml_lasso$coef_theta,
xtdml_lasso$se_theta,
xtdml_lasso$pval_theta,
xtdml_lasso$model_rmse,
as.numeric(xtdml_lasso$rmses["ml_l"]),
as.numeric(xtdml_lasso$rmses["ml_m"]),
xtdml_lasso$data$n_obs,
length(unique(xtdml_lasso$data$data_model[[xtdml_lasso$data$cluster_cols]])))
table[,3] = cbind(xtdml_nnet$coef_theta,
xtdml_nnet$se_theta,
xtdml_nnet$pval_theta,
xtdml_nnet$model_rmse,
as.numeric(xtdml_nnet$rmses["ml_l"]),
as.numeric(xtdml_nnet$rmses["ml_m"]),
xtdml_nnet$data$n_obs,
length(unique(xtdml_nnet$data$data_model[[xtdml_nnet$data$cluster_cols]])))
rownames(table)= c("Estimate", "Std. Error", "P-value", "Model RMSE", "MSE of l", "MSE of m",
"No. observations","No. groups")
colnames(table)= c("xtdml-Boosting", "xtdml-Lasso", "xtdml-Nnet")
print(round(table, 3))
toc()
}
#______________________________________________________________________________#
# Title:  Implementation of `xtdml` with simulated data
# Date: 01 October 2025
#______________________________________________________________________________#
rm(list = ls())
wd = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS"
setwd(wd)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
setwd(wd.pack)
devtools::load_all()
# Installation from CRAN
#install.packages("xtdml")
#library(xtdml)
# # # Installation from GitHub
# library(devtools)
# install_github("POLSEAN/xtdml")
# library(xtdml)
# wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
# setwd(wd.pack)
# devtools::load_all()
#______________________________________________________________________________#
# Install packages
# list.of.packages <- c("mlr3","mlr3learners","mlr3tuning","paradox","mlr3misc",
#                       "glmnet","xgboost","tibble", "dplyr","datawizard","data.table",
#                       "glue","MLmetrics","devtools","tictoc","wooldridge")
# new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
# if(length(new.packages)) install.packages(new.packages, repos = "http://cran.us.r-project.org")
library(mlr3)
library(mlr3learners)
library(paradox)
library(mlr3tuning)
library(mlr3misc)
library(glmnet)
library(xgboost)
library(nnet)
library(tibble)
library(dplyr)
library(datawizard)
library(data.table)
library(wooldridge)
library(tictoc)
# Suppress warning messages
lgr::get_logger("mlr3")$set_threshold("warn")
lgr::get_logger("bbotk")$set_threshold("warn")
#______________________________________________________________________________#
data('crime4')
yvar  = "crmrte"
dvar  = "polpc"
pvars = c("prbarr","prbconv","prbpris","avgsen")
xvars = c("density", "taxpc","west","central","urban","pctmin80",
"wcon","wtuc","wtrd","wfir","wser","wmfg","wfed","wsta","wloc",
"mix", "pctymle","d82", "d83","d84", "d85", "d86", "d87")
ln_xvars = c("lcrmrte","lprbarr","lprbconv", "lprbpris", "lavgsen", "ldensity",
"ltaxpc", "lwcon","lwtuc","lwtrd","lwfir","lwser","lwmfg",
"lwfed","lwsta","lwloc","lmix", "lpctymle", "lpctmin")
#______________________________________________________________________________#
approaches = "cre" #c("fd-exact","cre", "wg-approx")
for (approach in approaches){
print(paste0("approach:", approach))
tic(paste0(approach, "-run"))
set.seed(1234)
#______________________________________________________________________________#
# gradient boosting
#______________________________________________________________________________#
obj_xtdml_data_boost = xtdml_data_from_data_frame(crime4,
x_cols = c(xvars,pvars),  y_col = yvar, d_cols = dvar,
panel_id = "county", time_id = "year",
approach = approach, transformX = "no")
print(obj_xtdml_data_boost)
learner = lrn("regr.xgboost", nrounds = 100)
ml_m = learner$clone()
ml_l = learner$clone()
ml_g = learner$clone()
xtdml_boost = xtdml_plr$new(obj_xtdml_data_boost,
ml_l = ml_l, ml_m = ml_m, ml_g = ml_g,
n_folds = 3,
score = "orth-IV",
dml_procedure = "dml2",
draw_sample_splitting = TRUE,
apply_cross_fitting = TRUE)
param_grid = list("ml_l" = ps(max_depth = p_int(lower = 2, upper = 10),
lambda = p_dbl(lower = 0, upper = 5)),
"ml_m" = ps(max_depth = p_int(lower = 2, upper = 10),
lambda = p_dbl(lower = 0, upper = 2)),
"ml_g" = ps(max_depth = p_int(lower = 2, upper = 10),
lambda = p_dbl(lower = 0, upper = 2)))
tune_settings = list(n_folds_tune = 3,
rsmp_tune = mlr3::rsmp("cv", folds = 3),
terminator = mlr3tuning::trm("evals", n_evals = 10),
tuner = tnr("grid_search", resolution = 10))
xtdml_boost$tune(param_set = param_grid, tune_settings = tune_settings)
xtdml_boost$fit()
#xtdml_boost$print()
xtdml_boost$summary()
#______________________________________________________________________________#
# lasso
#______________________________________________________________________________#
obj_xtdml_data_lasso = xtdml_data_from_data_frame(crime4,
x_cols = c(xvars,ln_xvars,pvars),  y_col = yvar, d_cols = dvar,
panel_id = "county", time_id = "year",
approach = approach, transformX = "poly")
#print(obj_xtdml_data_lasso)
learner = lrn("regr.cv_glmnet", s="lambda.min")
ml_m = learner$clone()
ml_l = learner$clone()
ml_g = learner$clone()
xtdml_lasso = xtdml_plr$new(obj_xtdml_data_lasso,
ml_l = ml_l, ml_m = ml_m,ml_g = ml_g,
score = "orth-IV",
n_folds = 3)
xtdml_lasso$fit()
#xtdml_lasso$print()
xtdml_lasso$summary()
#______________________________________________________________________________#
# nnet
#______________________________________________________________________________#
obj_xtdml_data_nnet = xtdml_data_from_data_frame(crime4,
x_cols = c(xvars,pvars),  y_col = yvar, d_cols = dvar,
panel_id = "county", time_id = "year",
approach = approach, transformX = "minmax")
print(obj_xtdml_data_nnet)
ml_l = lrn("regr.nnet", maxit=100, MaxNWts=1000, trace=FALSE)
ml_m = lrn("regr.nnet", maxit=100, MaxNWts=1000, trace=FALSE)
ml_g = lrn("regr.nnet", maxit=100, MaxNWts=1000, trace=FALSE)
xtdml_nnet = xtdml_plr$new(obj_xtdml_data_nnet,
ml_l = ml_l, ml_m = ml_m,ml_g = ml_g,
score = "orth-IV",
n_folds = 3)
param_grid = list("ml_l" = ps(size = p_int(lower = 2, upper = 10),
decay = p_dbl(lower = 0, upper = 0.05)),
"ml_m" = ps(size = p_int(lower = 2, upper = 10),
decay = p_dbl(lower = 0, upper =  0.05)),
"ml_g" = ps(size = p_int(lower = 2, upper = 10),
decay = p_dbl(lower = 0, upper =  0.05)))
tune_settings = list(n_folds_tune = 3,
rsmp_tune  = mlr3::rsmp("cv", folds = 3),
terminator = mlr3tuning::trm("evals", n_evals = 10),
tuner      = tnr("grid_search", resolution = 10))
xtdml_nnet$tune(param_set = param_grid, tune_settings = tune_settings)
xtdml_nnet$fit()
#xtdml_nnet$print()
xtdml_nnet$summary()
#____________________________________________________________________________#
# Display table that compares results
#____________________________________________________________________________#
table = matrix(0, 8, 3)
table[,1] = cbind(xtdml_boost$coef_theta,
xtdml_boost$se_theta,
xtdml_boost$pval_theta,
xtdml_boost$model_rmse,
as.numeric(xtdml_boost$rmses["ml_l"]),
as.numeric(xtdml_boost$rmses["ml_m"]),
xtdml_boost$data$n_obs,
length(unique(xtdml_boost$data$data_model[[xtdml_boost$data$cluster_cols]])))
table[,2] = cbind(xtdml_lasso$coef_theta,
xtdml_lasso$se_theta,
xtdml_lasso$pval_theta,
xtdml_lasso$model_rmse,
as.numeric(xtdml_lasso$rmses["ml_l"]),
as.numeric(xtdml_lasso$rmses["ml_m"]),
xtdml_lasso$data$n_obs,
length(unique(xtdml_lasso$data$data_model[[xtdml_lasso$data$cluster_cols]])))
table[,3] = cbind(xtdml_nnet$coef_theta,
xtdml_nnet$se_theta,
xtdml_nnet$pval_theta,
xtdml_nnet$model_rmse,
as.numeric(xtdml_nnet$rmses["ml_l"]),
as.numeric(xtdml_nnet$rmses["ml_m"]),
xtdml_nnet$data$n_obs,
length(unique(xtdml_nnet$data$data_model[[xtdml_nnet$data$cluster_cols]])))
rownames(table)= c("Estimate", "Std. Error", "P-value", "Model RMSE", "MSE of l", "MSE of m",
"No. observations","No. groups")
colnames(table)= c("xtdml-Boosting", "xtdml-Lasso", "xtdml-Nnet")
print(round(table, 3))
toc()
}
rm(list = ls())
#df = read.csv("C:/Users/annal/Dropbox/IADS/ESS_CausalML/ESS25/labs/day_10/xtdml_data.csv")
#names(df)
#saveRDS(df, file = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/XTDML/data/sample_data.rds")
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
setwd(wd.pack)
devtools::document()         # Documents function.Rd in man folder
devtools::check()
devtools::check()
rm(list = ls())
#df = read.csv("C:/Users/annal/Dropbox/IADS/ESS_CausalML/ESS25/labs/day_10/xtdml_data.csv")
#names(df)
#saveRDS(df, file = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/XTDML/data/sample_data.rds")
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
# library(devtools)  # for building R packages
library(mlr3pipelines)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
setwd(wd.pack)
devtools::document()         # Documents function.Rd in man folder
devtools::check()
devtools::document()         # Documents function.Rd in man folder
devtools::check()
devtools::load_all()
?xtdml
?xtdml_plr$tune
?xtdml$tune
?xtdml$tune()
rm(list = ls())
#df = read.csv("C:/Users/annal/Dropbox/IADS/ESS_CausalML/ESS25/labs/day_10/xtdml_data.csv")
#names(df)
#saveRDS(df, file = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/XTDML/data/sample_data.rds")
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
# library(devtools)  # for building R packages
library(mlr3pipelines)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/xtdml"
setwd(wd.pack)
devtools::document()         # Documents function.Rd in man folder
devtools::check()
devtools::load_all()
version()
Rversion()
rversion()
sessionINfo()
sessionInfo()
sessionInfo()
installr
install.packages("installr")
rm(list = ls())
#df = read.csv("C:/Users/annal/Dropbox/IADS/ESS_CausalML/ESS25/labs/day_10/xtdml_data.csv")
#names(df)
#saveRDS(df, file = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/XTDML/data/sample_data.rds")
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
# library(devtools)  # for building R packages
library(mlr3pipelines)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/xtdml" /#submissions/JSS/
setwd(wd.pack)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/xtdml" /#submissions/JSS/
setwd(wd.pack)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/xtdml" /#submissions/JSS/
setwd(wd.pack)
#______________________________________________________________________________#
# Title:  Check 'XTDML' R package
# Date: August 2025
# IN NAMESPACE add: importFrom(R6, R6Class)
#______________________________________________________________________________#
rm(list = ls())
#df = read.csv("C:/Users/annal/Dropbox/IADS/ESS_CausalML/ESS25/labs/day_10/xtdml_data.csv")
#names(df)
#saveRDS(df, file = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/XTDML/data/sample_data.rds")
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
# library(devtools)  # for building R packages
library(mlr3pipelines)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/xtdml" #submissions/JSS/
setwd(wd.pack)
devtools::document()         # Documents function.Rd in man folder
devtools::check()
devtools::load_all()
roxygenize()
devtools::check()
devtools::load_all()
?xtdml
sessionInfo()
roxygenise()
#______________________________________________________________________________#
# Title:  Check 'XTDML' R package
# Date: August 2025
# IN NAMESPACE add: importFrom(R6, R6Class)
#______________________________________________________________________________#
rm(list = ls())
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
# library(devtools)  # for building R packages
library(mlr3pipelines)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/xtdml" #submissions/JSS/
setwd(wd.pack)
devtools::document()         # Documents function.Rd in man folder
#______________________________________________________________________________#
# Title:  Check 'XTDML' R package
# Date: August 2025
# IN NAMESPACE add: importFrom(R6, R6Class)
#______________________________________________________________________________#
rm(list = ls())
#df = read.csv("C:/Users/annal/Dropbox/IADS/ESS_CausalML/ESS25/labs/day_10/xtdml_data.csv")
#names(df)
#saveRDS(df, file = "C:/Users/annal/Dropbox/IADS/dml/submissions/JSS/XTDML/data/sample_data.rds")
#install.packages("mlr3pipelines")
library(roxygen2)  # for documenting your functions
# library(devtools)  # for building R packages
library(mlr3pipelines)
wd.pack = "C:/Users/annal/Dropbox/IADS/dml/xtdml" #submissions/JSS/
setwd(wd.pack)
devtools::build()
devtools::check()
